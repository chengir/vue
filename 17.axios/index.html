<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" conent="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="index.css">
    <script src="axios.js"></script>
    <script src="vue.js"></script>
</head>

<body>
    <div id="app">
        <div class="username">
            <input type="text" placeholder="用户名" v-model="name">
        </div>
        <div class="mail">
            <input type="text" placeholder="邮箱" v-model="mail">
        </div>
        <div class="upload-btn" @click="handelUpload">上传</div>
        <div class="show-btn" @click="handleShow">显示人物信息</div>
        <button @click="handleCancel">取消get请求</button>
        <ul class="person-list" v-if="personList.length">
            <li class="person" v-for="person in personList">
                <span>{{ person.name }}</span>
                <span>{{ person.mail }}</span>
            </li>
        </ul>
    </div>
    <script>
        //全局配置
        // axios.defaults.baseURL = 'https://developer.duyiedu.com/vue';
        axios.defaults.baseURL='http://127.0.0.1:12306';
        axios.defaults.timeout = 10000;


        //请求拦截器
        // axios.interceptors.request.use(config => {
        //     // if (config.method === 'get') {

        //     // } else if (config.method === 'post') {

        //     // }
        //     // config.method='post';
        //     // config.url='setUserInfo';
        //     return config;
        // });

        //响应拦截器
        const interceptor = axios.interceptors.response.use(response => {
            if (response.status === 200) {
                return response.data;
            } else {
                //
            }
        },error=>{  
            //处理错误都放在拦截器中统一处理
            if(error.response){
                console.log("响应时错误！");
            }else if(error.request){
                console.log("请求时错误！");
            }
            return Promise.reject(error);
        });
        //删除响应拦截器
        // axios.interceptors.response.eject(interceptor);
        //创建一个axios实例，并添加请求拦截器
        // const instance = axios.create();
        // instance.interceptors.request.use(config => {});

        //取消请求
        const source = axios.CancelToken.source();

        const vm = new Vue({
            el: '#app',
            data: {
                name: '',
                mail: '',
                msg: '',
                personList: []
            },
            methods: {
                handelUpload() {
                    const {
                        name,
                        mail
                    } = this;
                    // axios.post('https://developer.duyiedu.com/vue/setUserInfo', {
                    //     name,
                    //     mail
                    // }).then(res => {
                    //     this.msg = res.data.msg;
                    // })
                    

                    //请求地址错误
                    // axios.post('/setUserInfo1',{
                    //     name:'chen',
                    //     mail:'chen@qq.com'
                    // })
                
                    //请求地址正确
                    axios.post('/setUserInfo',{
                        name:'chen',
                        mail:'chen@qq.com'
                    })
                },
                handleShow() {
                    // axios({
                    //     methods: 'get',
                    //     baseURL: 'https://developer.duyiedu.com/vue',
                    //     url: '/getUserInfo'
                    // }).then(res => {
                    //     this.msg = res.data.msg;
                    //     this.personList = res.data.data;
                    // })

                    //并发
                    // axios.all([
                    //     axios.post('/setUserInfo', {
                    //         name: 'keke',
                    //         mail: '93847@qq.com'
                    //     }),
                    //     axios.get('/getUserInfo'),
                    // ]).then(axios.spread((postRes, getRes) => {
                    //     console.log(getRes, postRes);
                    // }))

                    // axios.get('/setUserInfo').then(config => {
                    //     console.log(config);
                    // })

                    // axios.get('/getUserInfo').then(response => {
                    //     console.log(response);
                    // })


                    //发送地址错误
                    axios.get('/getUserInfo1', {
                        cancelToken: source.token
                    }).then(res => {
                        console.log(res);
                    }).catch(error=>{
                        if(axios.isCancel(error)){
                            alert(error.message);
                            console.log(error.response,error.request);
                            if(error.response){
                                console.log("响应时错误！");
                            }else if(error.request){
                                console.log("请求时错误！")
                            }else{
                                console.log(error.message); //未发送出去
                            }
                        }else{
                            //处理错误
                        }
                    })
                },
                handleCancel() {
                    source.cancel("取消请求了，不能发送了");
                }
            },
            watch: {
                msg() {
                    if (this.msg === '') {
                        return;
                    }
                    alert(this.msg);
                }
            }
        })
    </script>
</body>

</html>